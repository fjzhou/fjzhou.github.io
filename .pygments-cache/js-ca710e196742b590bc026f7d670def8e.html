<div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;devicemotion&quot;</span><span class="p">,</span> <span class="nx">deviceMotionHandler</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">deviceMotionHandler</span><span class="p">(</span><span class="nx">eventData</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">SHAKE_THRESHOLD</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">acceleration</span> <span class="o">=</span> <span class="nx">eventData</span><span class="p">.</span><span class="nx">accelerationIncludingGravity</span><span class="p">;</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="nx">acceleration</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
    <span class="nx">y</span> <span class="o">=</span> <span class="nx">acceleration</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
    <span class="nx">z</span> <span class="o">=</span> <span class="nx">acceleration</span><span class="p">.</span><span class="nx">z</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">curTime</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">diffTime</span> <span class="o">=</span> <span class="nx">curTime</span> <span class="o">-</span> <span class="nx">last_update</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">diffTime</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">last_update</span> <span class="o">=</span> <span class="nx">curTime</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">speed</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">z</span> <span class="o">-</span> <span class="nx">last_x</span> <span class="o">-</span> <span class="nx">last_y</span> <span class="o">-</span> <span class="nx">last_z</span><span class="p">)</span> <span class="o">/</span> <span class="nx">diffTime</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">speed</span> <span class="o">&gt;</span> <span class="nx">SHAKE_THRESHOLD</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 摇一摇</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// 摇的不够</span>
        <span class="p">}</span>
        <span class="nx">last_x</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
        <span class="nx">last_y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">;</span>
        <span class="nx">last_z</span> <span class="o">=</span> <span class="nx">z</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>